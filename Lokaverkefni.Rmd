TODO túlka og mögulega finna betri plot pakka.


```{r}


tree.data2 <- tree(AgeNew~.,data=train.set2)

plot(tree.data2)
text(tree.data2,pretty=0)

tree.pred <- predict(tree.data2,newdata=test.set2, type="class")

#TEST MSE 
#tree.test.MSE <- mean((tree.pred-test.set2$AgeNew)**2)

pred.table <- table(tree.pred,test.set2$AgeNew)

tree.testMSE <- round(1-mean(tree.pred == test.set2$AgeNew),2)

testMSEperc <- percent(tree.testMSE)
```

`r testMSEperc` 

TODO: Bæta við texta hér. 

```{r}

tree.data2.cv <- cv.tree(tree.data2)

plot(tree.data2.cv$size,tree.data2.cv$dev,type="b")

prune.tree.data2 <- prune.tree(tree.data2,best=7) 

plot(prune.tree.data2)
text(prune.tree.data2,pretty=0)

pruned.tree.pred <- predict(prune.tree.data2,newdata=test.set2, type="class")

#pruned.tree.test.MSE <- mean((pruned.tree.pred-test.set2$AgeNew)**2)

pruned.tree.testMSE <- round(1-mean(pruned.tree.pred == test.set2$AgeNew),2)

testMSEperc <- percent(pruned.tree.testMSE)
```

`r testMSEperc`
TODO útskýra frekar. 
We get the same test MSE from the pruned tree. 
TODO: Spurning hvort við viljum vera með öll þessi plot?



Finding out the optimal mtry value for random forrest 
```{r}

randforr_MSE <- rep(NA,ncol(train.set2)-1)

#þessi skipun tekur um 10 min að keyra í minni tölvu. 
for (i in 1:(ncol(train.set2)-1)) {
  randforr_cs <- randomForest(AgeNew~.,data=train.set2,mtry=i,importance=T)
  pred_randforr <- predict(randforr_cs,newdata = test.set2)
  randforr_MSE[i] <- mean((pred_randforr==test.set2$AgeNew))
  #print("Höfum keyr í gegn")
  #print(i)
  #print("sinnum")
  
}
randforr_MSE



min.cv <- (1-which.max(randforr_MSE))
best.CV <- which.max(randforr_MSE)

plot(randforr_MSE, type = "b",xlab = "Degree", ylab = "Test MSE", main="Test MSE by number of variables")
points(best.CV, randforr_MSE[best.CV], col = "darkred",pch = 10,cex =12)




```




Using random Forest with the optimal mtry variable which is `r best.cv`
```{r}
#library(rpart)
library(visreg)


randforr_best <- randomForest(AgeNew~.,data=train.set2,mtry=best.CV,importance=T,ntree=1000) #TODO skoða að breyta Ntree og mögulega mtry, því fleiri sem ntree eru því lengri tíma tekur að keyra. 
pred_randforr <- predict(randforr_best,newdata = test.set2)
randforr_MSE <- round(1-mean((pred_randforr==test.set2$AgeNew)),2)

plot(randforr_best) # TODO breyta þessu plotti, ég hélt að þetta myndi ekki virka en viti menn.
#text(randforr_best,pretty=0)
  
  
varImpPlot(randforr_best)

randforr_MSE.perc <- percent(randforr_MSE)

#visreg(randforr_best)     Er að leita að betri pakka til að plotta. 
#autoplot(randforr_best)
```
`r randforr_MSE.perc`


TODO : muna að breyta randomForest í forlykkjur þar sem mtry = (1:ncol(train.set2)) og hafa ntree ekki of mikið. 

Using the Random forest yields a much better test MSE than the regression tree method. 
TODO útskýra betur og bera saman við niðurstöðurnar frá QDA og LDA.
