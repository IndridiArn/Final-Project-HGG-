---
title: "Lokaverkefni nafn hér"
author: "Bergrós Skúladóttir, Indriði Arnaldsson & Íris Aníta Eyþórsdóttir"
date: "11/12/2020"
output:
  prettydoc::html_pretty:
    theme : hpstr
    highlight: github
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F, error = F)
```

```{css, echo=FALSE, class.output="scroll-100"}
.scroll-100 {
  max-height: 300px;
  overflow-y: auto;
  bakground-color:inherit;
}
pre[class] {
  max-height: 160px;
}
```

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(ggridges)
library(data.table)
```


## Reading data and cleanup
```{r}
data <- read_delim("https://www.skra.is/library/Samnyttar-skrar-/Fyrirtaeki-stofnanir/Fasteignamat-2019/gagnasafn_ib_2018.csv", ";", escape_double = FALSE, locale = locale(encoding = "ISO-8859-1"),
                                     trim_ws = TRUE)
data <- data %>% select(kdagur, nuvirdi, byggar, lyfta, ibm2, fjhaed, fjbilsk, fjbkar, fjsturt, fjklos, fjeld, fjherb, fjstof, fjgeym, matssvaedi, ibteg, svfn) %>%
  filter(matssvaedi < 1000) %>%
  mutate(lyfta = ifelse(lyfta >= 1, 1, 0)) %>%
  mutate(ibteg = ifelse(ibteg == 11, 1, 0)) %>%
  mutate_at("lyfta", factor) %>%
  mutate_at("matssvaedi", as.character) %>%
  mutate_at("ibteg", factor)
  
data$svfn <- recode_factor(data$svfn, `0000` = "Reykjavik", `1000`= "Kopavogur", `1100` = "Seltjarnarnes",`1300` = "Gardabaer", `1400` = "Hafnarfjordur", `1604` = "Mosfellsbaer")
data$kdagur <- as.Date(data$kdagur, format = "%d.%m.%Y")
data$yearkeypt <- format(data$kdagur, format="%Y")
data$age <- (as.numeric(data$yearkeypt)-data$byggar)
#number of negative values for property age - properties bought unfinished 
nrow(data[data$age<0,])

data <- select(data, -kdagur, -byggar)

#litirnir
ColorsDT <-  data.table(Group=LETTERS[1:5], Color=c("#5f3722", "#e9af6f", "#c9a899", "#a55a27", "#84583d", "#b86a41"), key="Group")

data %>%
  ggplot(aes(x=nuvirdi,y=svfn, fill=svfn)) +
       geom_density_ridges_gradient() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), legend.position = "none") + 
  ggtitle("Figure X: insert name") + xlim(c(0,100000)) + scale_fill_manual(values=ColorsDT$Color) + labs(y = " ", x = "Property Price")
 
ggplot(data) + geom_bar(aes(y=nuvirdi,x=year, fill=yearkeypt), stat="summary", position = "dodge", fun.y=median) + scale_fill_manual(values=ColorsDT$Color) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "gray"), legend.position = "none") + geom_hline(yintercept=median(data$nuvirdi), col = '#7b4912', size=1) + ggtitle("Figure X: Insert name") + labs(x="Sales Year", y="Median Property Price") + coord_flip()
```
